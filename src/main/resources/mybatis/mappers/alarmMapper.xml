<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shinhan.alarm">
	<!-- ÎØ∏ÌôïÏù∏ ÏïåÎ¶º Ï†ÑÏ≤¥ Ï°∞Ìöå -->
<<<<<<< HEAD
		<select id="alarmList" resultType="alarmChatDTO">
		SELECT NVL(NULL, 'üì¢ From. Ìù¨Ìù¨ÎÇôÏ∞∞') sender, 
			   MAX(A.AL_CONTENT) alContent, 
			   MAX(TO_CHAR(A.AL_DATE, 'YYYY-MM-DD / HH24:MI')) alDate, 
			   MAX(NF.CATE_NUM) cateNum, 
			   MAX(A.AL_REQ_SEQ) reqSeq 
		FROM ALARM A JOIN NF_CATEGORY NF ON (A.CATE_NUM = NF.CATE_NUM) 
					 JOIN QNA_BOARD Q ON (A.ID = Q.ID) 
		WHERE A.CATE_NUM = 4 -- Î¨∏Ïùò 
			  AND AL_CHECK = 'N' 
			  AND A.ID = 'b' 
		UNION ALL 
		SELECT NVL(NULL, 'üì¢ From. Ìù¨Ìù¨ÎÇôÏ∞∞') sender, 
			   MAX(A.AL_CONTENT) alContent, 
			   MAX(TO_CHAR(A.AL_DATE, 'YYYY-MM-DD / HH24:MI')) alDate, 
			   MAX(NF.CATE_NUM) cateNum, 
			   MAX(A.AL_REQ_SEQ) reqSeq 
		FROM ALARM A JOIN NF_CATEGORY NF ON (A.CATE_NUM = NF.CATE_NUM) 
					 JOIN DEAL_HISTORY D ON (A.ID = D.BUYER_ID) 
		WHERE A.CATE_NUM = 2 -- ÌåêÎß§ 
			  AND AL_CHECK = 'N' 
			  AND A.ID = 'dhfl123' 
		UNION ALL 
		SELECT MAX(S.ARTICLE_TITLE) sender, 
       		   MAX(A.AL_CONTENT) alContent, 
       		   MAX(TO_CHAR(A.AL_DATE, 'YYYY-MM-DD / HH24:MI')) alDate, 
       		   MAX(NF.CATE_NUM) cateNum, 
       		   MAX(A.AL_REQ_SEQ) reqSeq 
		FROM ALARM A JOIN NF_CATEGORY NF ON (A.CATE_NUM = NF.CATE_NUM) 
             		 JOIN DEAL_HISTORY DH ON (A.ID = DH.BUYER_ID) 
             		 JOIN DELIVERY D ON (DH.S_SEQ = D.S_SEQ) 
             		 JOIN SELL_PRODUCT S ON (S.PRODUCT_SEQ = SELL_SEQ) 
		WHERE A.CATE_NUM = 5 -- Î∞∞ÏÜ° 
      		  AND AL_CHECK = 'N' 
      		  AND A.ID = 'a' 
      		  AND D.D_STATUS = 'Î∞úÏÜ°ÏôÑÎ£å' 
=======
	<select id="alarmList" resultType="com.shinhan.heehee.dto.response.AlarmChatDTO">
		SELECT NULL sender,
		MAX(A.AL_CONTENT) alContent,
		MAX(TO_CHAR(A.AL_DATE, 'YYYY-MM-DD / HH24:MI')) alDate,
		MAX(NF.CATE_NUM) cateNum,
		MAX(A.AL_REQ_SEQ) reqSeq
		FROM ALARM A JOIN NF_CATEGORY NF ON (A.CATE_NUM = NF.CATE_NUM)
		JOIN DEAL_HISTORY D ON (A.ID = D.BUYER_ID)
		WHERE A.CATE_NUM = 2
		AND A.ID = 'dhfl123'
>>>>>>> branch 'feat/hyunsang' of https://github.com/Sh03Team05/HeeHee.git
		UNION ALL
		SELECT CM.SENDER sender, 
			   MAX(A.AL_CONTENT) alContent, 
			   MAX(TO_CHAR(CM.SEND_TIME, 'YYYY-MM-DD / HH24:MI')) alDate, 
			   MAX(NF.CATE_NUM) cateNum, 
			   MAX(A.AL_REQ_SEQ) reqSeq 
		FROM ALARM A JOIN NF_CATEGORY NF ON (A.CATE_NUM = NF.CATE_NUM) 
					 JOIN CHAT_MESSAGE CM ON (A.ID = CM.RECEIVER) 
		WHERE A.CATE_NUM = 1 -- Ï±ÑÌåÖ 
			  AND AL_CHECK = 'N' 
			  AND CM.READ_CHECK = 'N' 
			  AND A.ID = 'b' 
		GROUP BY CM.SENDER
		ORDER BY alDate DESC
	</select>
</mapper>